parcelRequire=function(e,r,n,t){function i(n,t){function o(e){return i(o.resolve(e))}function c(r){return e[n][1][r]||r}if(!r[n]){if(!e[n]){var l="function"==typeof parcelRequire&&parcelRequire;if(!t&&l)return l(n,!0);if(u)return u(n,!0);if(f&&"string"==typeof n)return f(n);var p=new Error("Cannot find module '"+n+"'");throw p.code="MODULE_NOT_FOUND",p}o.resolve=c;var a=r[n]=new i.Module(n);e[n][0].call(a.exports,o,a,a.exports,this)}return r[n].exports}function o(e){this.id=e,this.bundle=i,this.exports={}}var u="function"==typeof parcelRequire&&parcelRequire,f="function"==typeof require&&require;i.isParcelRequire=!0,i.Module=o,i.modules=e,i.cache=r,i.parent=u;for(var c=0;c<n.length;c++)i(n[c]);if(n.length){var l=i(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):t&&(this[t]=l)}return i}({18:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class s{constructor(){this.listeners=new Map}on(s,e){this.listeners.has(s)||this.listeners.set(s,[]),this.listeners.get(s).push(e)}emit(s,e){const t=this.listeners.get(s);if(t)for(const s of t)s(e)}}exports.default=s;
},{}],32:[function(require,module,exports) {
"use strict";var I;Object.defineProperty(exports,"__esModule",{value:!0}),function(I){I[I.ESCAPE_ACCELERATION=0]="ESCAPE_ACCELERATION",I[I.FRICTION=1]="FRICTION",I[I.HUNT_ACCELERATION=2]="HUNT_ACCELERATION",I[I.MAX_BITE_SIZE=3]="MAX_BITE_SIZE",I[I.MAX_RADIUS=4]="MAX_RADIUS",I[I.MITOSIS_MIN_RADIUS=5]="MITOSIS_MIN_RADIUS",I[I.VISION_RANGE=6]="VISION_RANGE",I[I.MAX_VELOCITY=7]="MAX_VELOCITY"}(I||(I={})),exports.default=I;
},{}],19:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("../stat")),s=t(require("./index"));class l{constructor(t){this.cell=t}tick(t){const e=this.cell.getVisibleEntities(t);for(const t of e)t instanceof s.default&&this.interactWithCell(t);this.cell.move()}interactWithCell(t){const e=this.cell.isTouching(t);this.cell.canEat(t)?e?this.cell.eat(t):this.hunt(t):t.canEat(this.cell)&&this.escapeFrom(t)}hunt(t){const s=this.cell.getStat(e.default.HUNT_ACCELERATION),l=t.pos.sub(this.cell.pos).setMagnitude(s);this.cell.shove(l)}escapeFrom(t){const s=this.cell.getStat(e.default.ESCAPE_ACCELERATION),l=t.pos.sub(this.cell.pos).setMagnitude(s);this.cell.shove(l)}}exports.default=l;
},{"../stat":32,"./index":17}],8:[function(require,module,exports) {
"use strict";function t(t,r){return 0===arguments.length?Math.random():(1===arguments.length&&(r=t,t=0),Math.round(Math.random()*(r-t))+t)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.PI=Math.PI,exports.TAU=2*Math.PI,exports.abs=Math.abs,exports.max=Math.max,exports.min=Math.min,exports.sqrt=Math.sqrt,exports.pow=Math.pow,exports.random=t;const r=[1,10,100];function o(t){for(;r.length<t+1;)r.push(Math.pow(10,r.length+1));return r[t]}function e(t,r=2){if(0===r)return Math.round(t);const e=o(r);return Math.round(t*e)/e}exports.round=e;
},{}],20:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../math"),s=t(require("../stat")),i=t(require("./index"));class r{constructor(t,e){this.cell=t,this.state=e,this.state.isAlive=!0,this.state.size=1}get isAlive(){return this.state.isAlive}get size(){return this.state.size}set size(t){this.state.size=t,0===t&&this.die()}get energy(){return e.pow(this.size,2)*Math.PI}set energy(t){this.size=e.sqrt(t/Math.PI)}canMitos(){const t=this.cell.getStat(s.default.MITOSIS_MIN_RADIUS);return this.size>t}mitos(){const t=this.cell.getStat(s.default.MITOSIS_MIN_RADIUS),e=Math.floor(this.size/(t/2)),r=this.energy/e,h=[];for(let t=0;t<e;t++){const t=new i.default;t.energy=r,this.inherit(t),h.push(t)}return this.cell.emit("mitos",h),this.die(),h}die(){this.state.isAlive=!1,this.cell.emit("die",this.cell)}inherit(t){t.setParent(this.cell)}}exports.default=r;
},{"../math":8,"../stat":32,"./index":17}],21:[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("../stat"));class s{constructor(e){this.cell=e,this.types=new Map}addType(e,t){this.types.set(e,t)}eat(e){if(!this.cell.canEat(e))throw new Error(`Invalid food source: ${e}`);const s=this.cell.energy,r=e.energy,i=this.consider(e),c=s*this.cell.getStat(t.default.MAX_BITE_SIZE),l=r>c?c:r;return e.energy-=l,this.cell.energy+=l*i,this.cell.emit("eat",e),!0}consider(e){const t=e.constructor;return this.types.get(t)||0}}exports.default=s;
},{"../stat":32}],7:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("./math");class i{constructor(t,i){if(this.x=t,this.y=i,isNaN(t)||isNaN(i))throw new Error(`Creating vector with NaN: ${this}`)}static of(t,s){return new i(t,s)}static from({x:t=0,y:s=0}){return new i(t,s)}static apply(t,...s){return i.of(t(...s.map(t=>t.x)),t(...s.map(t=>t.y)))}static range({x:t=0,y:s=0}){return this.iterate(i.of(t,s))}static*iterate(t,s=new i(0,0)){const e=this.apply(Math.min,t,s),r=this.apply(Math.max,t,s);for(let t=e.x;t<r.x;t++)for(let i=e.y;i<r.y;i++)yield e.add({x:t,y:i})}get isZero(){return 0===this.x&&0===this.y}get magnitude(){return this.isZero?0:(this._magnitude||(this._magnitude=Math.hypot(this.x,this.y)),this._magnitude)}get radians(){if(this.isZero)return 0;const{x:t,y:i}=this;let s=Math.atan(i/t);return s<0&&(s+=Math.PI),(i<0||0===i&&t<0)&&(s+=Math.PI),s}setMagnitude(t){if(0===this.magnitude)return i.of(t,0);const s=this.magnitude/t;return i.of(this.x/s,this.y/s)}distance(t){return this.sub(t).magnitude}is({x:t=this.x,y:i=this.y}){return this.x===t&&this.y===i}sub({x:t=0,y:s=0}){return i.of(this.x-t,this.y-s)}add({x:t=0,y:s=0}){return i.of(this.x+t,this.y+s)}multiply({x:t=1,y:s=1}){return i.of(this.x*t,this.y*s)}diff({x:s=this.x,y:e=this.y}){return i.of(t.abs(this.x-s),t.abs(this.y-e))}toString(){return`[Vector(${this.x}, ${this.y})]`}toJSON(){return{$type:"vector",x:this.x,y:this.y}}}i.ZERO=i.of(0,0),exports.default=i;
},{"./math":8}],22:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("../stat")),s=t(require("../vector"));class i{constructor(t,e){this.cell=t,this.state=e,this.shoves=[],e.pos=s.default.ZERO,e.velocity=s.default.ZERO}get pos(){return this.state.pos}set pos(t){this.state.pos=t}get velocity(){return this.state.velocity}set velocity(t){this.state.velocity=t}shove(t){const s=this.cell.getStat(e.default.MAX_RADIUS),i=this.cell.size,l=1-Math.max(i/s,0),o=t.multiply({x:l,y:l});this.shoves.push(o)}friction(t=this.velocity){const s=this.cell.getStat(e.default.FRICTION),i=this.cell.getStat(e.default.MAX_RADIUS),{size:l}=this.cell,o=.5*(1-s)+.5*(l/i);this.velocity=t.multiply({x:o,y:o})}move(){const t=this.cell.getStat(e.default.MAX_VELOCITY);let s=this.velocity;for(const t of this.shoves)s=s.add(t);s.magnitude>t&&(s=s.setMagnitude(t)),this.shoves.length=0,this.pos=this.pos.add(s),this.friction(s)}}exports.default=i;
},{"../stat":32,"../vector":7}],23:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class s{constructor(s){this.cell=s,this.parents=new Set}setParent(s){this.parents.add(s)}isFamily(s){return this.isChildOf(s)||this.isParentOf(s)||this.isSibling(s)}isParentOf(s){return s.isChildOf(this.cell)}isChildOf(s){return this.parents.has(s)}isSibling(s){for(const t of this.parents)if(s.isChildOf(t))return!0;return!1}}exports.default=s;
},{}],24:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const t=require("../math"),e=new Map;class r{constructor(t){this.cell=t,this.color=o(this.cell.id)}render(e){const{pos:r,velocity:o,size:s}=this.cell,l=0|s,i=0*l;e.save(),e.translate(r.x,r.y),e.rotate(o.radians-t.TAU/4),e.fillStyle=this.color,e.beginPath(),e.arc(0,0,l,0,t.TAU),e.fill(),e.moveTo(l,i),e.lineTo(0,1.5*l+i),e.lineTo(-l,i),e.closePath(),e.fill(),e.restore()}}function o(t){const r=e.get(t);if(r)return r;const o=s();return e.set(t,o),o}function s(){return`#${t.random(0,16777215).toString(16).padStart(6,"0")}`}exports.default=r;
},{"../math":8}],25:[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("../stat"));class s{constructor(e){this.cell=e}getVisionRange(){return this.cell.size+this.cell.getStat(t.default.VISION_RANGE)}getVisibleEntities(e){const t=this.getVisionRange();return e.getEntitiesIn(this.cell.pos,t).filter(e=>e!==this.cell)}canSee(e){const t=this.getVisionRange();return this.cell.pos.distance(e.pos)<=t+e.size}isTouching(e){return this.cell.pos.distance(e.pos)<=this.cell.size+e.size}considerFight(e){return this.cell.size-e.size}}exports.default=s;
},{"../stat":32}],33:[function(require,module,exports) {
exports.buffer=function(t){const s=t._bufferProps=t._bufferProps||[];t._isDoubleBuffer=!0,Object.assign(t.prototype,{getState(){const t={};for(const{prop:e,state:r}of s)t[e]=this[r];return t},setState(t){this._isBufferDirty=!1;for(const{prop:e,state:r,next:f}of s)this[r]=t[e],this[f]=t[e]},flushState(){if(this._isBufferDirty){this._isBufferDirty=!1;for(const{state:t,next:e}of s)this[t]=this[e]}}})},exports.bufferProp=function(t,s){const e=t.constructor,r=`_${s}`,f=`_${s}_next`;(e._bufferProps=e._bufferProps||[]).push({prop:s,state:r,next:f}),Object.defineProperty(t,s,{get(){return this[r]},set(t){this[f]=t,this._isBufferDirty=!0}})};
},{}],26:[function(require,module,exports) {
"use strict";var t=this&&this.__decorate||function(t,e,r,o){var s,f=arguments.length,i=f<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,r,o);else for(var p=t.length-1;p>=0;p--)(s=t[p])&&(i=(f<3?s(i):f>3?s(e,r,i):s(e,r))||i);return f>3&&i&&Object.defineProperty(e,r,i),i};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("./state-decorators");let r=class{constructor(t){this.cell=t,this.stats=new Map}getStat(t){return this.stats.get(t)}setStat(t,e){this.stats.set(t,e)}getState(){return null}setState(t){}flushState(){}};t([e.bufferProp],r.prototype,"isAlive",void 0),t([e.bufferProp],r.prototype,"size",void 0),t([e.bufferProp],r.prototype,"pos",void 0),t([e.bufferProp],r.prototype,"velocity",void 0),r=t([e.buffer],r),exports.default=r;
},{"./state-decorators":33}],17:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("../emitter")),s=t(require("./behavior")),i=t(require("./body")),r=t(require("./diet")),n=t(require("./physic")),h=t(require("./relations")),o=t(require("./renderer")),a=t(require("./senses")),u=t(require("./state"));let d=0;const l=window.cells=[];class c{constructor(t=d++){this.id=t,this.behavior=new s.default(this),this.diet=new r.default(this),this.relations=new h.default(this),this.renderer=new o.default(this),this.senses=new a.default(this),this.state=new u.default(this),this.body=new i.default(this,this.state),this.physic=new n.default(this,this.state),this.emitter=new e.default,l[this.id]=this,this.flushState()}toString(){return`[Cell ${this.id}]`}toJSON(){return Object.assign({$type:"cell"},this.getState())}getStat(t){return this.state.getStat(t)}setStat(t,e){this.state.setStat(t,e)}getState(){return this.state.getState()}setState(t){return this.state.setState(t)}flushState(){return this.state.flushState()}on(t,e){this.emitter.on(t,e)}emit(t,e){this.emitter.emit(t,e)}get isAlive(){return this.body.isAlive}get size(){return this.body.size}set size(t){this.body.size=t}get energy(){return this.body.energy}set energy(t){this.body.energy=t}canMitos(){return this.body.canMitos()}mitos(){return this.body.mitos()}die(){return this.body.die()}setDietType(t,e=1){this.diet.addType(t,e)}eat(t){return this.diet.eat(t)}canEat(t){return!(t instanceof c&&this.isFamily(t))&&this.considerFood(t)>0}considerFood(t){const e=this.diet.consider(t);return t instanceof c?e*this.considerFight(t):e}getVisionRange(){return this.senses.getVisionRange()}getVisibleEntities(t){return this.senses.getVisibleEntities(t)}canSee(t){return this.senses.canSee(t)}isTouching(t){return this.senses.isTouching(t)}considerFight(t){return this.senses.considerFight(t)}setParent(t){this.relations.setParent(t)}isFamily(t){return this.relations.isFamily(t)}isParentOf(t){return this.relations.isParentOf(t)}isChildOf(t){return this.relations.isChildOf(t)}isSibling(t){return this.relations.isSibling(t)}get pos(){return this.physic.pos}set pos(t){this.physic.pos=t}get velocity(){return this.physic.velocity}set velocity(t){this.physic.velocity=t}shove(t){return this.physic.shove(t)}move(){return this.physic.move()}tick(t){return this.behavior.tick(t)}render(t){return this.renderer.render(t)}}exports.default=c;
},{"../emitter":18,"./behavior":19,"./body":20,"./diet":21,"./physic":22,"./relations":23,"./renderer":24,"./senses":25,"./state":26}],34:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(t){this.size=t,this.entities=new Set}add(t){this.entities.add(t)}remove(t){this.entities.delete(t)}getEntitiesAlive(){return[...this.entities]}getEntitiesAt(t){const e=[];for(const s of this.entities){const{x:i,y:n}=t.diff(s.pos),{size:o}=s;i<o&&n<o&&s.pos.distance(t)<=o&&e.push(s)}return e}getEntitiesIn(t,e){const s=t.sub({x:e,y:e}),i=t.add({x:e,y:e}),n=[];for(const o of this.entities){const{size:r}=o,d=s.sub({x:r,y:r}),c=i.add({x:r,y:r}),{x:u,y:x}=o.pos,a=e+o.size;u>=d.x&&u<=c.x&&x>=d.y&&x<=c.y&&o.pos.distance(t)<=a&&n.push(o)}return n}}exports.default=t;
},{}],27:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("../cell")),s=require("../math"),l=t(require("../stat")),i=t(require("../world"));class r{constructor(t,e){this.game=t,this.world=new i.default(e)}addCell(t){const l=new e.default;return l.size=4+s.random(2),l.pos=t,this.setUpCell(l),l}reviveCell(t){const s=new e.default(t);return this.setUpCell(s),s}setUpCell(t){t.setStat(l.default.ESCAPE_ACCELERATION,1),t.setStat(l.default.FRICTION,.3),t.setStat(l.default.HUNT_ACCELERATION,1),t.setStat(l.default.MAX_BITE_SIZE,10),t.setStat(l.default.MAX_RADIUS,200),t.setStat(l.default.MAX_VELOCITY,10),t.setStat(l.default.MITOSIS_MIN_RADIUS,50),t.setStat(l.default.VISION_RANGE,300),t.flushState(),this.world.add(t)}getEntitiesAlive(){return this.world.getEntitiesAlive()}tickEntities(){const{world:t}=this,s=this.getEntitiesAlive();for(const l of s)l instanceof e.default&&!l.isAlive?t.remove(l):l.tick(t);return s}}exports.default=r;
},{"../cell":17,"../math":8,"../stat":32,"../world":34}],28:[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const s=e(require("../vector"));class t{constructor(e,{isHistoryEnabled:s}={}){this.game=e,this.mouse=null,this.isListening=!1,this.inspector=new Set,this.onClick=this.onClick.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onKeyPress=s?this.onKeyPressHistory.bind(this):this.onKeyPress.bind(this)}interact(){const{game:e}=this,{world:s}=e;if(!this.mouse)return;const t=s.getEntitiesAt(this.mouse),i=new Set([...this.inspector,...t]);for(const s of i)e.renderCellDetails(s)}addListeners(e){if(this.isListening)return!1;document.addEventListener("keypress",this.onKeyPress),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("click",this.onClick)}onClick(e){this.mouse=s.default.from(e);const{game:t,inspector:i}=this,{world:o}=t,a=o.getEntitiesAt(this.mouse);for(const e of a)i.has(e)?i.delete(e):i.add(e);this.game.updateView()}onKeyPress(e){switch(e.code){case"Space":this.game.isPaused=!this.game.isPaused}}onKeyPressHistory(e){switch(e.code){case"Space":this.game.isPaused=!this.game.isPaused;break;case"KeyA":case"KeyJ":this.game.playback();break;case"KeyS":case"KeyK":this.game.stepback();break;case"KeyD":case"KeyL":this.game.step();break;case"KeyF":case"Semicolon":this.game.play()}}onMouseMove(e){this.mouse=s.default.from(e),this.game.updateView()}}exports.default=t;
},{"../vector":7}],29:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../math");class t{constructor(e,t){this.game=e,this.canvas=t}renderEntities(){const{game:e,canvas:t}=this,{width:i,height:o}=t,s=e.getEntitiesAlive(),r=t.getContext("2d");r.clearRect(0,0,i,o);for(const e of s)e.render(r)}renderCellDetails(e){this.renderCellVision(e),this.renderCellBehavior(e)}renderCellVision(e){for(const t of e.getVisibleEntities(this.game.world))this.drawLine(e.pos,t.pos,{width:.5,color:"rgba(0, 0, 0, 50)"});const t=e.getVisionRange();this.drawCircle(e.pos,t,{color:"red"})}renderCellBehavior(e){const t=e.velocity.multiply({x:100,y:100});this.drawLine(e.pos,t.add(e.pos),{color:"blue",width:2})}drawLine(e,t,{color:i="black",width:o=1}={}){const s=this.canvas.getContext("2d");s.lineWidth=o,s.strokeStyle=i,s.beginPath(),s.moveTo(e.x,e.y),s.lineTo(t.x,t.y),s.closePath(),s.stroke()}drawCircle(t,i,{color:o="black",width:s=1}={}){const r=this.canvas.getContext("2d");r.lineWidth=s,r.strokeStyle=o,r.beginPath(),r.arc(t.x,t.y,i,0,e.TAU),r.closePath(),r.stroke()}}exports.default=t;
},{"../math":8}],30:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("../math"),s=t(require("../cell"));class i{constructor(t,{maxHistory:e}={}){this.game=t,this.history=new Map,this.maxHistory=e}get olderStepSaved(){return e.min(...this.history.keys())}get newerStepSaved(){return e.max(...this.history.keys())}tick(t){if(this.hasStep(t))this.setState(this.history.get(t));else for(t<this.olderStepSaved&&(0!==t&&console.warn("Wiped saved history"),this.reset());!this.hasStep(t);)this.processStep()}loadForeignState(t){this.initialStep=t,this.reset()}getState(){return this.history.get(this.newerStepSaved)}reset(){this.setState(this.initialStep),this.history.clear(),this.history.set(0,this.initialStep)}hasStep(t){return this.history.has(t)}saveInitialStep(){const t=this.game.tickEntities(),e={};for(const s of t)e[s.id]=s.getState();this.initialStep=e,this.reset()}setState(t){const e=this.game.getEntitiesAlive(),i=new Set(Object.keys(t).map(Number));for(const r of e){const e=t[r.id];i.delete(r.id),e?r.setState(t[r.id]):r instanceof s.default&&r.die()}for(const e of i){this.game.reviveCell(e).setState(t[e])}}processStep(){const t=this.game.tickEntities(),e={};for(const s of t)s.flushState(),e[s.id]=s.getState();this.saveStep(e)}saveStep(t){const{history:e}=this;e.set(this.newerStepSaved+1,t),e.size>this.maxHistory&&e.delete(this.olderStepSaved)}}exports.default=i;
},{"../math":8,"../cell":17}],31:[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class s{constructor(s){this.callback=s,this._speed=1,this.cursor=-1,this.isRunning=!1,this.isPaused=!1,this.onTick=this.onTick.bind(this)}get speed(){return this._speed}set speed(s){if(1!==s&&-1!==s)throw new Error(`Invalid speed ${s}`);this._speed=s}get isForward(){return 1===this.speed}get isBackwards(){return-1===this.speed}get isAtBegining(){return this.cursor<=0}start(){this.isRunning||(this.isRunning=!0,requestAnimationFrame(this.onTick))}stop(){this.isRunning=!1}play(){this.speed=1,this.isPaused=!1,this.start()}playback(){this.speed=-1,this.isPaused=!1,this.start()}step(){this.speed=1,this.isPaused=!0,this.execute()}stepback(){this.speed=-1,this.isPaused=!0,this.execute()}pause(){this.isPaused=!0}execute(){if(this.isBackwards&&this.isAtBegining)return console.warn("Can't go further in history!"),void(this.isPaused=!0);this.cursor+=this.speed,this.callback.call(null,{turn:this.cursor})}onTick(){this.isRunning&&(requestAnimationFrame(this.onTick),this.isPaused||this.execute())}}exports.default=s;
},{}],16:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("./entities")),i=t(require("./interaction")),s=t(require("./renderer")),r=t(require("./state")),n=t(require("./ticker"));class a{constructor(t,a,{maxHistory:h=100,onTick:u}={}){this.canvas=t,this.onTick=u,this.entities=new e.default(this,a),this.renderer=new s.default(this,t),this.state=new r.default(this,{maxHistory:h}),this.ticker=new n.default(this.tick.bind(this)),this.interaction=new i.default(this,{isHistoryEnabled:Boolean(h)})}get world(){return this.entities.world}init(){this.addListeners(),this.state.saveInitialStep(),this.start(),this.pause(),this.render()}tick({turn:t}){const e=this.getEntitiesAlive();this.state.tick(t),this.updateView(),this.onTick({tick:t,entities:e})}updateView(){this.render(),this.interaction.interact()}get isPaused(){return this.ticker.isPaused}set isPaused(t){this.ticker.isPaused=t}get speed(){return this.ticker.speed}set speed(t){this.ticker.speed=t}goTo(t){return this.state.tick(t)}start(){return this.ticker.start()}stop(){return this.ticker.stop()}play(){return this.ticker.play()}playback(){return this.ticker.playback()}pause(){return this.ticker.pause()}step(){return this.ticker.step()}stepback(){return this.ticker.stepback()}getEntitiesAlive(){return this.entities.getEntitiesAlive()}addCell(t){return this.entities.addCell(t)}reviveCell(t){return this.entities.reviveCell(t)}tickEntities(){return this.entities.tickEntities()}addListeners(){this.interaction.addListeners(this.canvas)}getState(){return this.state.getState()}setState(t){return this.state.loadForeignState(t)}render(){return this.renderer.renderEntities()}renderCellDetails(t){return this.renderer.renderCellDetails(t)}}exports.default=a;
},{"./entities":27,"./interaction":28,"./renderer":29,"./state":30,"./ticker":31}],9:[function(require,module,exports) {
"use strict";var t=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const e=t(require("../src/vector"));function o(t,o){return"object"==typeof o&&o.$type&&"vector"===o.$type?e.default.from(o):o}function r(t,e){return String(t).padStart(e,"0")}function n(t){return`${t.getFullYear()}-${r(t.getMonth()+1,2)}-${r(t.getDate(),2)} ${r(t.getHours(),2)}:${r(t.getMinutes(),2)}:${r(t.getSeconds(),2)}.${r(t.getMilliseconds(),3)}`}function l(t){return n(new Date(t))===t}exports.default={load(t){const e=localStorage.getItem(t);return e?JSON.parse(e,o):null},save(t){const e=n(new Date),o=JSON.stringify(t);localStorage.setItem(e,o),this.trim()},rename(t,e){localStorage.setItem(e,localStorage.getItem(t))},log(){const t=Object.keys(localStorage);if(t.length){console.log("Found stored states:");for(const e of t)console.log(`  load("${e}")`)}},trim(){const t=Object.keys(localStorage);for(;t.length>10;)l(t[0])&&localStorage.removeItem(t[0]),t.shift()}};
},{"../src/vector":7}],4:[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("../src/game")),n=e(require("../src/vector")),r=require("../src/math"),o=e(require("../src/cell")),i=e(require("./persisted-state"));async function a(){await s();const e=document.querySelector("#fps"),a=document.querySelector("#entities"),d=document.querySelector("#tick"),l=window.innerWidth,c=window.innerHeight-4;console.log({width:l,height:c});let f=Date.now();const w=u(),g=w.get("cells")||10,m=document.querySelector("canvas#world"),h=new t.default(m,n.default.of(l,c),{maxHistory:w.get("history"),onTick:function({tick:t,entities:n}){const o=Date.now(),i=o-f;f=o,d.innerHTML=String(t),a.innerHTML=String(n.length),e.innerHTML=String(r.round(1e3/i,0))}});m.width=l,m.height=c;for(let e=0;e<g;e++){const e=r.random(0,l),t=r.random(0,c);h.addCell(n.default.of(e,t)).setDietType(o.default)}h.init(),i.default.save(h.getState()),i.default.log(),w.get("pause")||h.play(),Object.assign(window,{game:h,rename:i.default.rename,load(e){h.setState(i.default.load(e)),h.render()}})}function s(){return new Promise(e=>window.addEventListener("DOMContentLoaded",e))}function u(){const e=window.location.search.substr(1).split("&").filter(Boolean).map(e=>{const[t,n]=e.split("="),r=parseInt(n);if(isNaN(r))throw new Error(`Invalid option "${t}" is not a number "${n}" "${r}"`);return[t,r]});return new Map(e)}a();
},{"../src/game":16,"../src/vector":7,"../src/math":8,"../src/cell":17,"./persisted-state":9}]},{},[4], null)
//# sourceMappingURL=main.40f74609.map