const fs = require('fs');

edit('./node_modules/webpack-dev-server/client/index.js', (x) =>
  x.replace(
    `    log.error('[WDS] Errors while compiling. Reload prevented.');`,
    `    if (!options.initial) {
      this["content-changed"]();
      return;
    }

    log.error('[WDS] Errors while compiling. Reload prevented.');`,
  ),
);

function edit(filename, edition) {
  fs.readFile(filename, 'utf8', function (err, data) {
    if (err) {
      return console.log(err);
    }

    var result = edition(data);

    if (result === data) {
      return console.log(`Nothing to change for '${filename}'`);
    }

    fs.writeFile(filename, result, 'utf8', function (err) {
      if (err) return console.log(err);
    });
  });
}
